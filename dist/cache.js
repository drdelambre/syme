"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_storageController=require("./internal/storage-controller"),_storageController2=_interopRequireDefault(_storageController);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Cache=function(){function r(e){_classCallCheck(this,r);var t=e||{};if(this.key=t.key||this.constructor.name,this.channel=t.channel||"memory",this.expiration=parseInt(t.expiration||500,10),!/^(memory|local|session)$/.test(this.channel))throw new Error(["Invalid storage mechanism sent","to "+this.constructor.name+".channel"].join(" "));if("undefined"==typeof window&&(this.channel="memory"),isNaN(this.expiration))throw new Error(["Invalid expiration time set for",this.constructor.name+".expiration"].join(" "));t.model&&(this.model=t.model),Object.defineProperty(this,"cached",{get:function(){var e=_storageController2.default.get(this.channel,this.key),t=_storageController2.default.freshness(this.channel,this.key);if(!t&&Object.keys(e).length||t&&Date.now()-t<this.expiration){if(this.model){var r=new this.model;return r.fill(e),r}return e}return t&&_storageController2.default.remove(this.channel,this.key,!1),!1},set:function(){throw new Error("cached is a read only property")}})}return _createClass(r,[{key:"populate",value:function(e){var t=e;return this.model&&e instanceof this.model&&(t=e.out()),_storageController2.default.populate(this.channel,this.key,this.expiration,t),this}},{key:"clear",value:function(){return _storageController2.default.remove(this.channel,this.key),this}},{key:"watch",value:function(r){var n=this;return _storageController2.default.register(this.channel,this.key,function(e){if(n.model){var t=new n.model;t.fill(e),r(t)}else r(e)})}}]),r}();exports.default=Cache;