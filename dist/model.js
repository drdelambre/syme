"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_throttledObserver=require("./internal/throttled-observer.js"),_throttledObserver2=_interopRequireDefault(_throttledObserver),_magicArray=require("./internal/magic-array.js"),_magicArray2=_interopRequireDefault(_magicArray),_magicMethod=require("./internal/magic-method.js"),_magicMethod2=_interopRequireDefault(_magicMethod);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var blacklist=new RegExp("^(_.*|constructor|onUpdate|fill|out|errors|validate|extend|keys|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|should|before|clear)$"),TOSTR=Object.prototype.toString,Model=function(){function a(e){_classCallCheck(this,a),this._def={},this._changeThrottle=new _throttledObserver2.default,this.extend(e)}return _createClass(a,[{key:"onUpdate",value:function(e,t){this._changeThrottle.onFire(e,t)}},{key:"fill",value:function(e){var t,r=e;for(t in e instanceof a&&(r=e.out()),r)this._def.hasOwnProperty(t)&&(this[t]=r[t]);return this}},{key:"clear",value:function(){var e=void 0,t=void 0;for(e in this._def)t=this._def[e].default,this._def[e].value instanceof a?this[e].clear():"[object Array]"===TOSTR.call(t)?this[e]=new _magicArray2.default(this._def,e,this._changeThrottle):this[e]=t;return this}},{key:"out",value:function(){var e,t,r,n,o={};for(e in this._def)if(n=this._def[e].value,"[object Array]"!==TOSTR.call(this._def[e].default))o[e]=n instanceof a?n.out():n;else{if(r=[],this._def[e].type)for(t=0;t<n.length;t++)n[t]instanceof a&&r.push(n[t].out());else r=n.slice(0);o[e]=r}return o}},{key:"extend",value:function(e){var t;for(t in e)blacklist.test(t)||(e[t]instanceof a||"function"==typeof e[t]&&e[t].prototype instanceof a?this._def[t]={default:null,value:new e[t],type:e[t],before:[]}:"[object Array]"===TOSTR.call(e[t])?(this._def[t]={default:[],type:e[t].length?e[t][0]:null,before:[]},this._def[t].value=new _magicArray2.default(this._def,t,this._changeThrottle)):this._def[t]={default:e[t],value:e[t],type:null,before:[]},(0,_magicMethod2.default)(this,this._def,t,this._changeThrottle));return this}},{key:"before",value:function(e){var t;function r(e){return"function"==typeof e}for(t in e){if(!this._def.hasOwnProperty(t))throw new Error("Model: called before on a property ("+t+") that does not exist");"[object Array]"!==TOSTR.call(e[t])&&(e[t]=[e[t]]),e[t].filter(r),this._def[t].before=this._def[t].before.concat(e[t])}return this}},{key:"keys",value:function(){var e,t,r=[],n={},o=this;do{for(e=Object.getOwnPropertyNames(o),t=0;t<e.length;t++)blacklist.test(e[t])||(n[e[t]]=!0)}while(o=Object.getPrototypeOf(o));for(t in n)r.push(t);return r}}]),a}();exports.default=Model;